{% extends 'base.html' %}
{% load static %}

{% block title %}{{ part.name }} | CarParts{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/part_detail.css' %}" />

<div class="part-detail">
  <h1>{{ part.name }}</h1>
  <img src="{% static part.image_url %}" alt="{{ part.name }}" class="part-image">
  <p><strong>Brand:</strong> {{ part.brand }}</p>
  <p><strong>Price:</strong> ${{ part.price }}</p>
  {% if avg_rating %}
    <p><strong>Rating:</strong> {{ avg_rating|floatformat:1 }} / 5</p>
  {% else %}
    <p><strong>Rating:</strong> Not rated yet</p>
    
  {% endif %}
  <p><strong>Description:</strong> {{ part.description }}</p>

  <!-- Rating Section -->
  <h2>Rate this part</h2>
  <form method="post" action="{% url 'add_review' part.pk %}">
    {% csrf_token %}
    <label for="rating">Rating (1 to 5):</label>
    <input type="number" id="rating" name="rating" min="1" max="5" required>
    <button type="submit">Submit Rating</button>
  </form>

  <h2>Comments</h2>
  <!-- Add Comment -->
  <form method="post" action="{% url 'add_comment' part.pk %}">
    {% csrf_token %}
    <textarea name="comment_text" rows="3" placeholder="Add a comment..." required></textarea>
    <button type="submit">Add Comment</button>
  </form>

  <!-- Display Comments -->
  {% for comment in part.comments.all %}
  <div class="comment">
    <p><strong>{{ comment.user.username }}</strong>: {{ comment.comment_text }}</p>
    {% if comment.user == request.user %}
    <form method="post" action="{% url 'delete_comment' comment.pk %}" style="display:inline;">
      {% csrf_token %}
      <button type="submit">Delete</button>
    </form>
    <form method="get" action="{% url 'update_comment' comment.pk %}" style="display:inline;">
      <button type="submit">Edit</button>
    </form>
    {% endif %}
  </div>
  {% empty %}
  <p>No comments yet.</p>
  {% endfor %}
</div>
{% endblock %}
